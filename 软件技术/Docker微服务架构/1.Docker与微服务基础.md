# Docker 与微服务基础

## 1. 微服务架构概述

### 什么是微服务

什么是微服务：

1. CORBA：部署过于复杂，已被淘汰；
2. DCOM：微软为了对抗 CORBA 与 RMI 而发布的分布式计算框架。有以下特点：
   - 与语言无关、位置独立、优化网络、负载均衡、支持容错性；
3. RMI：Java 1.1推出的分布式计算协议。有以下特点：
   - 面向对象、可移动属性、分层的设计方式、安全性高、便于编写和使用、可连接现有/原有的系统、编写一次到处运行、分布式垃圾收集、并行计算；不支持跨语言开发。
4. SOA：Service-Oriented Architecture，面向服务的体系结构。如今最流行的微服务架构。SOA 主要依赖两种消息机制来解决分布式协同问题：
   1. 基于请求响应的 WEB 契约协议。包括基于 HTTP/XML 的通信协议（SOAP）、服务接口描述语言（WSDL）、以及服务查找接口（UDDI）；
   2. 基于事件 EDA 的企业服务总线（ESB）。

### 为什么要使用微服务

一个常见互联网公司的五层静态逻辑架构：

1. 应用层：面向客户的最终软件交付物；
2. 前端服务层：各种重业务的聚合入口，实现了业务调用链条的封装；
3. 业务服务层：包括各种基础的业务服务单元。比如：借款系统、还款系统；
4. 基础服务层：不包含状态的基础业务服务。比如：短信业务（SMS）、文件网关；
5. 数据层：包括各种形态的数据存储层。比如：各种数据库、缓存、消息队列等。

常见的 API 网关主要有以下的作用：

1. 统一对外接口：降低对外暴露的服务，增加系统的安全性；
2. 统一鉴权：不需要每个应用单独对调用方进行鉴权，应用可以专注于业务；
3. 服务注册与授权：明确调用方可以调用的接口权限；
4. 服务限流：限制调用次数与流量
5. 全链路跟踪：监控调用流程以及调用的相应时间等。

### 微服务架构设计原则

流行的 ToGaf 一般会把 EA（企业架构）分为五层或者六层。笔者把软件架构分为以下的四个层次：

1. 业务架构：主要参与人员是产品经理与运营人员；
2. 逻辑架构：这一层主要关心的是如何将业务框架的组件落地成为一个个服务中心和应用单元，各个服务的边界如何划分，服务与服务之间如何编排等。服务的编排模式一般有以下几种：