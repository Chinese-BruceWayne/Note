# 第一部分：数据结构与对象

## 简单动态字符串

Redis 没有使用 C 语言中的 `\0` 结尾的方式表示一个字符串，而是自己构建了一个结构 SDS (Simple Dynamic String) 作为基本字符串类型。这一结构的定义和实现分别在源码的 `src/sds.h`/`src/sds.c` 这两个文件中，以最长 256 字节长度串的结构为例：

```c
struct __attribute__ ((__packed__)) sdshdr8 {
    uint8_t len; /* used */
    uint8_t alloc; /* excluding the header and null terminator */
    unsigned char flags; /* 3 lsb of type, 5 unused bits */
    char buf[];
};
```

由上面的源码可以看出 SDS 结构的核心是：

1. `len`：已经使用的字符串长度；

2. `alloc`：总共分配的缓冲区长度；

   SDS 为了兼容 C 语言的空字符串结尾，会额外分配一个字节的大小，如果假设字符串可以增加的大小为 `rmd`，那么有公式：`alloc = rmd + len + 1`；

3. `buf`：字符串字面量；

## 链表

Redis 链表的底层是一个无环双向链表，结构可以在源代码的 `src/adlink.h`/`src/adlink.c` 这两个文件中看到：

```c
typedef struct listNode {
    struct listNode *prev;
    struct listNode *next;
    void *value;
} listNode;
```

## 字典