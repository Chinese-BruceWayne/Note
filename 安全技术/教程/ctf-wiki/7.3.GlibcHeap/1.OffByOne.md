# `Off By One` 漏洞

## 漏洞原理

严格来说 `off-by-one` 漏洞是一种特殊的溢出漏洞，`off-by-one` 指程序向缓冲区中写入时，写入的字节数超过了这个缓冲区本身所申请的字节数并且只越界了一个字节。

一般来说，单字节溢出被认为是难以利用的，但是因为 Linux 的堆管理机制 `ptmalloc` 验证的松散性，基于 Linux 堆的 `off-by-one` 漏洞利用起来并不复杂，并且威力强大。

## 利用思路

根据溢出的字节类型，可以分为以下两种情况：

1. 溢出字节为任意可以控制的字节。通过修改大小造成块之间出现重叠，从而泄露或覆盖其他块的数据。
2. 溢出字节为 `NULL` 字节。在 `size=0x100` 时，溢出 `NULL` 字节会使 `prev_in_use` 位被清零：
   1. 这时可以选择 `unlink` 方法进行处理；
   2. 另外 `prev_size` 域就会启用，伪造 `prev_size` 可以造成块之间的重叠（`glibc2.28` 已经修复）。

## 例子

[Asis CTF 2016 b00ks](../../../题目/ctf-wiki/offbyone.md)

