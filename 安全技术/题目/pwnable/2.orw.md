> 参考资料：
>
> - <https://www.anquanke.com/post/id/150359>

# ORW

首先检查安全保护等级：

```bash
$ checksec orw
[*] '/media/data/program/ctf/pwnable/orw/orw'
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX disabled
    PIE:      No PIE (0x8048000)
    RWX:      Has RWX segments
```

可以看到这个程序开启了以下保护机制：

- `Canary` 开启，部分 `RELOAD`，还有 `RWX` 读写执行段。

在 `gdb` 里面可以查看 `main` 函数的汇编代码：

```assembly
(gdb) info functions
All defined functions:

Non-debugging symbols:
0x08048330  _init
0x08048370  read@plt
0x08048380  printf@plt
0x08048390  __stack_chk_fail@plt
0x080483a0  __libc_start_main@plt
0x080483b0  prctl@plt
0x080483c0  __gmon_start__@plt
0x080483d0  _start
0x08048400  __x86.get_pc_thunk.bx
0x08048410  deregister_tm_clones
0x08048440  register_tm_clones
0x08048480  __do_global_dtors_aux
0x080484a0  frame_dummy
0x080484cb  orw_seccomp
0x08048548  main
0x080485a0  __libc_csu_init
0x08048600  __libc_csu_fini
0x08048604  _fini

(gdb) disas main
Dump of assembler code for function main:
   0x08048548 <+0>:     lea    0x4(%esp),%ecx
   0x0804854c <+4>:     and    $0xfffffff0,%esp
   0x0804854f <+7>:     pushl  -0x4(%ecx)
   0x08048552 <+10>:    push   %ebp
   0x08048553 <+11>:    mov    %esp,%ebp
   0x08048555 <+13>:    push   %ecx
   0x08048556 <+14>:    sub    $0x4,%esp
   0x08048559 <+17>:    call   0x80484cb <orw_seccomp>
   0x0804855e <+22>:    sub    $0xc,%esp
   0x08048561 <+25>:    push   $0x80486a0
   0x08048566 <+30>:    call   0x8048380 <printf@plt>
   0x0804856b <+35>:    add    $0x10,%esp
   0x0804856e <+38>:    sub    $0x4,%esp
   0x08048571 <+41>:    push   $0xc8
   0x08048576 <+46>:    push   $0x804a060
   0x0804857b <+51>:    push   $0x0
   0x0804857d <+53>:    call   0x8048370 <read@plt>
   0x08048582 <+58>:    add    $0x10,%esp
   0x08048585 <+61>:    mov    $0x804a060,%eax
   0x0804858a <+66>:    call   *%eax
   0x0804858c <+68>:    mov    $0x0,%eax
   0x08048591 <+73>:    mov    -0x4(%ebp),%ecx
   0x08048594 <+76>:    leave  
   0x08048595 <+77>:    lea    -0x4(%ecx),%esp
   0x08048598 <+80>:    ret    
End of assembler dump.
```

