# Chapter 01

## lab1-1

### Question 1

> Upload the files to http://www.VirusTotal.com/ and view the reports. Does
> either file match any existing antivirus signatures?

文件上传的 sha256 hash 值为：

```bash
$ sha256sum Lab01-01.exe 
58898bd42c5bd3bf9b1389f0eee5b39cd59180e8370eb9ea838a0b327bd6fe47  Lab01-01.exe
```

因此上传的 url 为：https://www.virustotal.com/#/file/58898bd42c5bd3bf9b1389f0eee5b39cd59180e8370eb9ea838a0b327bd6fe47/detection

可以看到许多病毒引擎都检测到这是一个木马。

### Question 2

> When were these files compiled?

PE 文件的文件结构可以参考[微软的官方文档](https://docs.microsoft.com/en-us/windows/desktop/debug/pe-format)。

可以找到在对象文件的的最开始，存在一个标准文件头，其中有一个 `TimeDateStamp` 域，指示了文件创建时的时间戳，可以使用以下的 python 脚本读取它：

```python
# lab1-1-2.py
from datetime import datetime
import pefile

pe = pefile.PE("/tmp/BinaryCollection/Chapter_1L/Lab01-01.exe")
print(datetime.fromtimestamp(pe.FILE_HEADER.TimeDateStamp))
```

```bash
$ python lab1-1-2.py
2010-12-20 00:16:19
```

### Question 3

> Are there any indications that either of these files is packed or obfuscated?
> If so, what are these indicators?

安装 BlackArch 的工具 `packerid`：

```bash
$ sudo pacman -S packerid
```

这是一个基于字节码特征匹配打包程序的命令行工具。

- 字节码特征我们使用 `pefile` 这个 python 开源库中的数据库：https://github.com/sooshie/packerid/blob/master/userdb.txt

  （另外我在运行程序时发现了一个报错，原因是字节码特征中出现了 `V3` 这类的字节码，暂时还不清楚这个字节码的含义是什么）

- 字节码文件保存在 `/usr/share/packerid/userdb.txt` 文件夹中

直接指定文件路径来分析 PE 文件：

```bash
$ packerid /tmp/BinaryCollection/Chapter_1L/Lab01-01.exe 
['Microsoft Visual C++ v5.0/v6.0 (MFC)']
```

可以看到这是一个 `VC++ MFC` 打包的文件，也就是说这个文件没有加壳。

### Question 4

> Do any imports hint at what this malware does? If so, which imports
> are they?

安装 BlackArch 的工具 `malscan`：

```bash
$ sudo pacman -S malscan
```

`malscan` 是一个启发式静态分析工具，使用一下命令检测：

```bash
$ malscan /tmp/BinaryCollection/Chapter_1L/Lab01-01.exe
...
[Imports Overview]

KERNEL32.dll
	0x402000 CloseHandle
	0x402004 UnmapViewOfFile
	0x402008 IsBadReadPtr
	0x40200c MapViewOfFile
	0x402010 CreateFileMappingA
	0x402014 CreateFileA
	0x402018 FindClose
	0x40201c FindNextFileA
	0x402020 FindFirstFileA
	0x402024 CopyFileA

MSVCRT.dll
	0x40202c malloc
	0x402030 exit
	0x402034 _exit
	0x402038 _XcptFilter
	0x40203c __p___initenv
	0x402040 __getmainargs
	0x402044 _initterm
	0x402048 __setusermatherr
	0x40204c _adjust_fdiv
	0x402050 __p__commode
	0x402054 __p__fmode
	0x402058 __set_app_type
	0x40205c _except_handler3
	0x402060 _controlfp
	0x402064 _stricmp
...
```

### Question 5

> Are there any other files or host-based indicators that you could look for
> on infected systems?

从之前的导入函数分析来看，